<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../../node_modules/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../../../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <title>KFC Order App</title>
    <style type="text/css">
        /* Styles for the banner image */
        #imgKFC {
            width: 100%; /* Image takes full width of its parent */
            height: 200px; /* Fixed height for the banner effect (adjust as needed) */
            object-fit: cover; /* Ensures image covers the area, cropping if necessary */
            display: block; /* Important for width/height to work consistently */
            border-radius: 0.375rem; /* Apply Bootstrap's rounded-3 border-radius from CSS */
            margin-bottom: 1.5rem; /* Add some space below the banner for spacing */
        }
        /* Style for required labels */
        .form-label.required::after {
            content: " *";
            color: red;
        }
        /* Style for the order summary section */
        #orderSummarySection {
            display: none; /* Hidden by default */
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #fff;
            border-radius: 0.375rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,.075);
        }
    </style>
</head>
<body class="container-fluid d-flex justify-content-center align-items-center vh-100 bg-light">

    <div class="col-12 col-md-8 col-lg-6 p-3 bg-black rounded shadow-sm">
        <div>
            <img src="../../images/leopard.jpg" alt="KFC Banner" id="imgKFC">
        </div>

        <div class="accordion" id="kfcOrderAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingCustomer">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCustomer" aria-expanded="true" aria-controls="collapseCustomer">
                        1. Enter Customer Details
                    </button>
                </h2>
                <div id="collapseCustomer" class="accordion-collapse collapse show" aria-labelledby="headingCustomer" data-bs-parent="#kfcOrderAccordion">
                    <div class="accordion-body">
                        <form id="customerForm">
                            <div class="mb-3">
                                <label for="customerName" class="form-label required">Name</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="mb-3">
                                <label for="customerAddress" class="form-label required">Address</label>
                                <textarea class="form-control" id="customerAddress" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="customerPhone" class="form-label required">Phone</label>
                                <input type="tel" class="form-control" id="customerPhone" pattern="[0-9]{10}" placeholder="e.g., 9876543210" required>
                                <small class="form-text text-muted">Please enter a 10-digit phone number.</small>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary mt-3">Save & Next</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingMeal">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMeal" aria-expanded="false" aria-controls="collapseMeal" disabled id="btnMealAccordion">
                        2. Select Your Meal
                    </button>
                </h2>
                <div id="collapseMeal" class="accordion-collapse collapse" aria-labelledby="headingMeal" data-bs-parent="#kfcOrderAccordion">
                    <div class="accordion-body">
                        <form id="mealForm">
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="meal" id="mealZinger" value="Zinger Burger Combo" data-price="299" required>
                                    <label class="form-check-label" for="mealZinger">
                                        Zinger Burger Combo (₹299)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="meal" id="mealBucket" value="Chicken Bucket (6 pc)" data-price="499">
                                    <label class="form-check-label" for="mealBucket">
                                        Chicken Bucket (6 pc) (₹499)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="meal" id="mealRiceBowlz" value="Rice Bowlz" data-price="199">
                                    <label class="form-check-label" for="mealRiceBowlz">
                                        Rice Bowlz (₹199)
                                    </label>
                                </div>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary mt-3">Save & Next</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingAddons">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAddons" aria-expanded="false" aria-controls="collapseAddons" disabled id="btnAddonsAccordion">
                        3. Select Add-ons
                    </button>
                </h2>
                <div id="collapseAddons" class="accordion-collapse collapse" aria-labelledby="headingAddons" data-bs-parent="#kfcOrderAccordion">
                    <div class="accordion-body">
                        <form id="addonsForm">
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="addon" id="addonFries" value="Fries (Large)" data-price="99">
                                    <label class="form-check-label" for="addonFries">
                                        Fries (Large) (₹99)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="addon" id="addonPepsi" value="Pepsi (Reg)" data-price="60">
                                    <label class="form-check-label" for="addonPepsi">
                                        Pepsi (Reg) (₹60)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="addon" id="addonChocoCake" value="Choco Lava Cake" data-price="120">
                                    <label class="form-check-label" for="addonChocoCake">
                                        Choco Lava Cake (₹120)
                                    </label>
                                </div>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary mt-3">Review Order</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="orderSummarySection">
            <h4 class="text-center mb-4">Your Order Summary</h4>
            <div id="summaryContent">
                </div>
            <hr>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <h5 class="mb-0">Total Payable: <span id="finalTotalDisplay">₹0.00</span></h5>
                <button type="button" class="btn btn-success" id="confirmOrderBtn">Confirm Order & Pay</button>
            </div>
            <p class="text-muted text-center mt-2">A representative will contact you for advance payment.</p>
        </div>

        <div class="modal fade" id="kfcConfirmationModal" tabindex="-1" aria-labelledby="kfcConfirmationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="kfcConfirmationModalLabel">Order Confirmed!</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="confirmationModalContent">
                        <p>Your order has been placed successfully. Thank you for choosing KFC!</p>
                        <div id="confirmationOrderDetails" class="mt-3"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="../../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">
        // Global object to store order data
        let orderData = {
            customer: {},
            meal: { name: '', price: 0 },
            addons: [],
            total: 0
        };

        // Get references to accordion buttons
        const btnMealAccordion = document.getElementById('btnMealAccordion');
        const btnAddonsAccordion = document.getElementById('btnAddonsAccordion');

        // Get references to forms
        const customerForm = document.getElementById('customerForm');
        const mealForm = document.getElementById('mealForm');
        const addonsForm = document.getElementById('addonsForm');

        // Get references to order summary elements
        const orderSummarySection = document.getElementById('orderSummarySection');
        const summaryContent = document.getElementById('summaryContent');
        const finalTotalDisplay = document.getElementById('finalTotalDisplay');
        const confirmOrderBtn = document.getElementById('confirmOrderBtn');

        // Get reference to the confirmation modal instance
        const confirmationModal = new bootstrap.Modal(document.getElementById('kfcConfirmationModal'));
        const confirmationOrderDetails = document.getElementById('confirmationOrderDetails');

        // Get accordion collapse instances
        const collapseCustomer = new bootstrap.Collapse(document.getElementById('collapseCustomer'), { toggle: false });
        const collapseMeal = new bootstrap.Collapse(document.getElementById('collapseMeal'), { toggle: false });
        const collapseAddons = new bootstrap.Collapse(document.getElementById('collapseAddons'), { toggle: false });

        // --- Event Listeners for Forms (Accordion Steps) ---

        customerForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            // Simple validation for required fields
            if (!customerForm.checkValidity()) {
                event.stopPropagation();
                customerForm.classList.add('was-validated'); // Show Bootstrap validation feedback
                return;
            }
            customerForm.classList.remove('was-validated');

            orderData.customer = {
                name: document.getElementById('customerName').value,
                address: document.getElementById('customerAddress').value,
                phone: document.getElementById('customerPhone').value
            };

            // Move to the next accordion item
            collapseCustomer.hide();
            btnMealAccordion.disabled = false; // Enable next accordion header
            collapseMeal.show();
        });

        mealForm.addEventListener('submit', function(event) {
            event.preventDefault();

            const selectedMealRadio = document.querySelector('input[name="meal"]:checked');
            if (!selectedMealRadio) {
                alert('Please select a meal!'); // Use alert for simplicity, could be more refined validation
                return;
            }

            orderData.meal = {
                name: selectedMealRadio.value,
                price: parseFloat(selectedMealRadio.dataset.price)
            };

            // Move to the next accordion item
            collapseMeal.hide();
            btnAddonsAccordion.disabled = false; // Enable next accordion header
            collapseAddons.show();
        });

        addonsForm.addEventListener('submit', function(event) {
            event.preventDefault();

            orderData.addons = []; // Reset addons array
            const selectedAddons = document.querySelectorAll('input[name="addon"]:checked');
            selectedAddons.forEach(addon => {
                orderData.addons.push({
                    name: addon.value,
                    price: parseFloat(addon.dataset.price)
                });
            });

            // Calculate total price
            orderData.total = orderData.meal.price;
            orderData.addons.forEach(addon => {
                orderData.total += addon.price;
            });

            // Close the addons accordion and show the summary section
            collapseAddons.hide();
            populateSummarySection(); // Populate the summary content
            orderSummarySection.style.display = 'block'; // Show the summary section
            orderSummarySection.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to summary
        });

        // --- Event Listener for Confirm Order Button (on summary section) ---

        confirmOrderBtn.addEventListener('click', function() {
            // Build the detailed text for the confirmation modal
            let confirmationText = `
                <p class="mb-1"><strong>Name:</strong> ${orderData.customer.name}</p>
                <p class="mb-1"><strong>Address:</strong> ${orderData.customer.address}</p>
                <p class="mb-1"><strong>Phone:</strong> ${orderData.customer.phone}</p>
                <hr>
                <p class="mb-1"><strong>Meal:</strong> ${orderData.meal.name} (₹${orderData.meal.price.toFixed(2)})</p>
            `;

            if (orderData.addons.length > 0) {
                confirmationText += `<p class="mb-1"><strong>Add-ons:</strong> ${orderData.addons.map(a => a.name + ' (₹' + a.price.toFixed(2) + ')').join(', ')}</p>`;
            } else {
                confirmationText += `<p class="mb-1"><strong>Add-ons:</strong> None</p>`;
            }

            confirmationText += `<h5 class="mt-3"><strong>Total:</strong> ₹${orderData.total.toFixed(2)}</h5>`;

            // Set the content of the confirmation modal
            confirmationOrderDetails.innerHTML = confirmationText;

            console.log('Final Order Data:', orderData);

            orderSummarySection.style.display = 'none'; // Hide the summary section
            confirmationModal.show(); // Show the confirmation modal
            resetOrderForm(); // Reset forms for a new order
        });


        // --- Helper Functions ---

        function populateSummarySection() {
            let summaryHtml = `
                <p><strong>Customer:</strong> ${orderData.customer.name}</p>
                <p><strong>Address:</strong> ${orderData.customer.address}</p>
                <p><strong>Phone:</strong> ${orderData.customer.phone}</p>
                <hr>
                <p><strong>Meal:</strong> ${orderData.meal.name} (₹${orderData.meal.price.toFixed(2)})</p>
            `;

            if (orderData.addons.length > 0) {
                summaryHtml += `<p class="mb-0"><strong>Add-ons:</strong></p><ul>`;
                orderData.addons.forEach(addon => {
                    summaryHtml += `<li>${addon.name} (₹${addon.price.toFixed(2)})</li>`;
                });
                summaryHtml += `</ul>`;
            } else {
                summaryHtml += `<p><strong>Add-ons:</strong> None</p>`;
            }

            summaryContent.innerHTML = summaryHtml;
            finalTotalDisplay.textContent = `₹${orderData.total.toFixed(2)}`;
        }

        // Function to reset all forms and order data for a new order
        function resetOrderForm() {
            orderData = {
                customer: {},
                meal: { name: '', price: 0 },
                addons: [],
                total: 0
            };

            // Reset forms
            customerForm.reset();
            mealForm.reset();
            addonsForm.reset();

            // Disable accordion headers and collapse all
            btnMealAccordion.disabled = true;
            btnAddonsAccordion.disabled = true;
            collapseCustomer.show(); // Open the first section for a new order
            collapseMeal.hide();
            collapseAddons.hide();

            // Hide summary section
            orderSummarySection.style.display = 'none';
        }

        // --- Pre-fill forms when accordion items are shown for editing ---

        document.getElementById('collapseCustomer').addEventListener('show.bs.collapse', function () {
            if (orderData.customer.name) {
                document.getElementById('customerName').value = orderData.customer.name;
                document.getElementById('customerAddress').value = orderData.customer.address;
                document.getElementById('customerPhone').value = orderData.customer.phone;
            } else {
                customerForm.reset(); // Clear form if no data
            }
            customerForm.classList.remove('was-validated'); // Clear validation feedback on re-opening
        });

        document.getElementById('collapseMeal').addEventListener('show.bs.collapse', function () {
            document.querySelectorAll('input[name="meal"]').forEach(radio => radio.checked = false);
            if (orderData.meal.name) {
                const mealRadio = document.querySelector(`input[name="meal"][value="${orderData.meal.name}"]`);
                if (mealRadio) mealRadio.checked = true;
            }
        });

        document.getElementById('collapseAddons').addEventListener('show.bs.collapse', function () {
            document.querySelectorAll('input[name="addon"]').forEach(checkbox => checkbox.checked = false);
            orderData.addons.forEach(addon => {
                const addonCheckbox = document.querySelector(`input[name="addon"][value="${addon.name}"]`);
                if (addonCheckbox) addonCheckbox.checked = true;
            });
        });

    </script>
</body>
</html>