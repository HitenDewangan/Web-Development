<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>Advanced User Directory</title>
    <style>
        .grid-view .card {
            min-width: 250px;
        }
        .grid-view .row {
            gap: 15px;
        }
    </style>
</head>
<body class="container-fluid m-3">
    <div class="mt-5">
        <h1 class="mb-4">Advanced User Directory</h1>
        
        <div class="d-flex justify-content-between mb-3 align-items-center">
            <div class="d-flex gap-2">
                <input type="text" id="searchInput" class="form-control" placeholder="Search by name..." style="width: 200px;">
                <button class="btn btn-secondary" onclick="sortUsers('asc')">Sort A -> Z</button>
                <button class="btn btn-secondary" onclick="sortUsers('desc')">Sort Z -> A</button>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="setView('list')">Switch to List View</button>
                <button class="btn btn-secondary" onclick="setView('grid')">Switch to Grid View</button>
            </div>
        </div>

        <div id="userContainer" class="list-view">
            </div>

        <nav aria-label="Page navigation" class="mt-4">
            <ul id="pagination" class="pagination justify-content-center">
                </ul>
        </nav>
    </div>

    <script>
        const API_URL = 'https://jsonplaceholder.typicode.com/users';
        const recordsPerPage = 5;
        let users = [];
        let currentPage = 1;
        let currentView = 'list';
        let currentSearchQuery = '';
        let currentSortOrder = 'asc';

        // Fetch data from the API
        async function fetchUsers() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                users = data;
                renderPage();
            } catch (error) {
                console.error('Fetch error:', error);
                document.getElementById('userContainer').innerHTML = `<p class="text-danger">Failed to load data.</p>`;
            }
        }

        // Render the current page with filtered and sorted data
        function renderPage() {
            const container = document.getElementById('userContainer');
            container.innerHTML = '';
            
            let filteredUsers = users.filter(user => 
                user.name.toLowerCase().includes(currentSearchQuery.toLowerCase())
            );

            filteredUsers.sort((a, b) => {
                const nameA = a.name.toLowerCase();
                const nameB = b.name.toLowerCase();
                if (currentSortOrder === 'asc') {
                    return nameA > nameB ? 1 : -1;
                } else {
                    return nameA < nameB ? 1 : -1;
                }
            });

            const totalPages = Math.ceil(filteredUsers.length / recordsPerPage);
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = startIndex + recordsPerPage;
            const usersToShow = filteredUsers.slice(startIndex, endIndex);

            if (usersToShow.length === 0) {
                container.innerHTML = `<p class="text-muted">No users found.</p>`;
            } else {
                if (currentView === 'list') {
                    renderListView(usersToShow);
                } else {
                    renderGridView(usersToShow);
                }
            }
            renderPagination(totalPages);
        }

        // Render the list view
        function renderListView(usersToRender) {
            const container = document.getElementById('userContainer');
            container.classList.remove('grid-view');
            container.classList.add('list-view');

            const table = document.createElement('table');
            table.className = 'table table-hover';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Company</th>
                    </tr>
                </thead>
                <tbody>
                    ${usersToRender.map(user => `
                        <tr>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>${user.company.name}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            container.appendChild(table);
        }

        // Render the grid view
        function renderGridView(usersToRender) {
            const container = document.getElementById('userContainer');
            container.classList.remove('list-view');
            container.classList.add('grid-view');

            const row = document.createElement('div');
            row.className = 'row';
            row.innerHTML = usersToRender.map(user => `
                <div class="col-sm-6 col-md-4 col-lg-3">
                    <div class="card shadow-sm p-3">
                        <h5>${user.name}</h5>
                        <p class="text-muted mb-1"><i class="bi bi-envelope me-2"></i>${user.email}</p>
                        <p class="text-muted mb-0"><i class="bi bi-building me-2"></i>${user.company.name}</p>
                    </div>
                </div>
            `).join('');
            container.appendChild(row);
        }

        // Render the pagination links
        function renderPagination(totalPages) {
            const paginationEl = document.getElementById('pagination');
            paginationEl.innerHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>`;
                paginationEl.appendChild(li);
            }
        }

        // Change the current page
        function goToPage(pageNumber) {
            currentPage = pageNumber;
            renderPage();
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('keyup', (e) => {
            currentSearchQuery = e.target.value;
            currentPage = 1; // Reset to the first page on search
            renderPage();
        });

        // Sorting functionality
        function sortUsers(order) {
            currentSortOrder = order;
            currentPage = 1; // Reset to the first page on sort
            renderPage();
        }

        // View toggle functionality
        function setView(view) {
            currentView = view;
            renderPage();
        }

        // Initial fetch
        document.addEventListener('DOMContentLoaded', fetchUsers);
    </script>
</body>
</html>